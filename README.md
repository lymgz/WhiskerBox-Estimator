# WhiskerBox-Estimator
WhiskerBox-Estimator：一键读取带须箱线图，自动估算均值与标准差，为网络元分析生成输入表。

===
## 带上下须线的箱线图数据转换器 (IQR Converter)
命令行建议版本, 没有GUI
## 概述

这是一个简洁的命令行工具，专门用于将箱线图数据转换为Mean±SD格式，特别适用于meta分析中需要统一数据格式的场景。程序基于Wan 2014和Luo 2018的统计学方法，能够准确地从箱线图的四分位数信息推算出均值和标准差。

## 功能特点

### 🎯 核心功能
- **箱线图数据转换**: 将Q1、Q2、Q3等箱线图数据转换为Mean±SD
- **多种转换方法**: 支持Wan 2014、Luo 2018、简单方法和自动选择
- **差值计算**: 自动计算两组间差值的Mean和SD
- **分布评估**: 自动评估数据分布特征，选择最佳转换方法

### 📊 处理模式
1. **单组转换**: 将箱线图数据转换为Mean±SD
2. **两组比较**: 基线组 vs 干预组，自动计算差值统计

### 💻 命令行界面
- **简洁高效**: 纯命令行操作，无GUI复杂性
- **灵活输入**: 支持命令行参数直接输入
- **多种输出**: 标准输出、详细模式、JSON格式

## 安装要求

### Python环境
- Python 3.7+
- numpy (用于数学计算)

### 安装依赖
```bash
pip install numpy
```

## 使用方法

### 基本语法
```bash
python simple_converter.py --q1 <值> --q2 <值> --q3 <值> --n1 <样本量> [选项]
```

### 使用示例

#### 1. 单组转换（基础数据）
```bash
python simple_converter.py --q1 10 --q2 15 --q3 20 --n1 30 --single
```

#### 2. 两组比较（基础数据）
```bash
python simple_converter.py --q1 10,12 --q2 15,16 --q3 20,21 --n1 30 --n2 30
```

#### 3. 高精度转换（包含须数据）
```bash
python simple_converter.py --q1 10,12 --q2 15,16 --q3 20,21 --upper 25,26 --lower 5,6 --n1 30 --n2 30
```

#### 4. 详细输出模式
```bash
python simple_converter.py --q1 10,12 --q2 15,16 --q3 20,21 --n1 30 --n2 30 --verbose
```

#### 5. JSON格式输出
```bash
python simple_converter.py --q1 10,12 --q2 15,16 --q3 20,21 --n1 30 --n2 30 --json
```

#### 6. 包含异常值的转换
```bash
python simple_converter.py --q1 10 --q2 15 --q3 20 --upper 25 --lower 5 --upper-outliers 30,35 --lower-outliers 2,1 --n1 30 --single
```

## 参数说明

### 必需参数
- `--q1`: Q1四分位数，多个值用逗号分隔
- `--q2`: Q2中位数，多个值用逗号分隔  
- `--q3`: Q3四分位数，多个值用逗号分隔
- `--n1`: 第一组样本量

### 可选参数
- `--n2`: 第二组样本量（两组比较时需要）
- `--upper`: 上须，多个值用逗号分隔
- `--lower`: 下须，多个值用逗号分隔
- `--upper-outliers`: 上异常值，逗号分隔
- `--lower-outliers`: 下异常值，逗号分隔

### 模式选项
- `--single`: 单组转换模式
- `--method`: 转换方法 (auto, wan2014, luo2018, simple)
- `--verbose`: 详细输出
- `--json`: JSON格式输出

## 统计方法说明 - 分级计算系统

### 🎯 核心理念："能读多少用多少"
程序采用分级计算系统，根据可用数据的完整程度自动选择最佳计算公式。

### 📊 数据等级分类

#### 等级 0：基础等级
- **可用数据**: Q1、Q2、Q3、样本量n
- **计算公式**: Wan 2014三数公式
  - Mean = (Q1 + Q2 + Q3) / 3
  - SD = (Q3 - Q1) / 1.35
- **预期精度**: 中等精度 (误差15-25%)

#### 等级 1：标准等级  
- **可用数据**: 等级0 + 上下须(min、max)
- **计算公式**: Wan 2014五数公式（加权计算）
  - 小样本(n≤15): Mean = (min + 2×Q1 + 2×Q2 + 2×Q3 + max) / 8
  - 中样本(15<n≤70): Mean = (min + Q1 + 2×Q2 + Q3 + max) / 6  
  - 大样本(n>70): Mean = (Q1 + 2×Q2 + Q3) / 4
- **预期精度**: 高精度 (误差8-15%)

#### 等级 2：最高等级
- **可用数据**: 等级1 + 异常值信息
- **计算公式**: Wan 2014五数公式 + 异常值偏态校正
- **预期精度**: 最高精度 (误差5-10%)

### 🔄 自动等级判定
程序会自动检测可用数据，选择对应等级的最佳公式进行计算。

## 输出格式

### 标准输出示例
```
============================================================
两组比较结果
============================================================

基线组 (n=30):
  Mean: 15.000
  SD:   7.407
  等级: 0 (中等精度 (误差15-25%))

干预组 (n=30):
  Mean: 16.333
  SD:   6.667
  等级: 0 (中等精度 (误差15-25%))

差值分析:
  差值Mean: 1.333
  差值SD:   9.966
  效应量:   0.189
  95%CI:    (-2.309, 4.976)
```

### 详细输出 (--verbose)
包含计算方法、分布评估等详细信息。

### JSON输出 (--json)
结构化的JSON格式，便于程序化处理。

## 数据要求

### 必需数据
- **Q1**: 第一四分位数 (25th percentile)
- **Q2**: 中位数 (50th percentile)
- **Q3**: 第三四分位数 (75th percentile)
- **样本量**: 每组的样本数量

### 可选数据
- **上须**: 箱线图上须的值
- **下须**: 箱线图下须的值
- **异常值**: 用逗号分隔多个值

### 数据约束
- Q1 ≤ Q2 ≤ Q3
- 下须 ≤ Q1, 上须 ≥ Q3
- 样本量 > 0

## 应用场景

### Meta分析
- 统一不同研究的数据格式
- 计算效应量和置信区间
- 快速批量处理

### 系统评价
- 从图表中提取数据
- 标准化数据格式
- 质量评估

### 研究数据处理
- 补充缺失的统计量
- 验证已有的计算结果
- 格式转换

## 常见问题

### Q: 如何处理多个部位的数据？
A: 对每个部位分别运行命令，或者编写简单的批处理脚本。

### Q: 数据验证失败怎么办？
A: 检查四分位数的顺序 (Q1 ≤ Q2 ≤ Q3) 和数值的合理性。

### Q: 转换结果不合理？
A: 检查原始数据是否正确，可以尝试不同的转换方法 (--method)。

### Q: 如何选择最佳转换方法？
A: 使用默认的 `--method auto`，程序会根据数据特征自动选择。

## 技术细节

### 核心算法
- **Wan 2014**: 基于四分位数的均值和标准差估计
- **Luo 2018**: 针对偏态分布的优化估计
- **自动选择**: 基于分布特征的智能方法选择

### 误差控制
- 分级计算系统确保最佳精度
- 样本量修正
- 偏态校正
- 置信区间计算

## 参考文献

- Wan, X., et al. (2014). Estimating the sample mean and standard deviation from the sample size, median, range and/or interquartile range. BMC Medical Research Methodology, 14, 135.
- Luo, D., et al. (2018). Optimally estimating the sample mean from the sample size, median, mid-range, and/or mid-quartile range. Statistical Methods in Medical Research, 27(6), 1785-1805.

## 版本信息

- **版本**: 2.0 (简化命令行版)
- **更新日期**: 2025年1月
- **兼容性**: Windows/Linux/macOS, Python 3.7+

## 许可证

MIT

